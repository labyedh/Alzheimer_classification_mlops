# .github/workflows/ci.yml

name: Run DVC Pipeline on Kaggle

on:
  push:
    branches:
      - main

jobs:
  train-on-kaggle-gpu:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install -r requirements.txt

      # --- START OF FIX ---
      # Add this step to install the Kaggle CLI
      - name: Install Kaggle CLI
        run: pip install kaggle
      # --- END OF FIX ---

      - name: Set up Kaggle API
        env:
          KAGGLE_KEY: ${{ secrets.KAGGLE_JSON }}
        run: |
          mkdir -p ~/.kaggle
          echo "$KAGGLE_KEY" > ~/.kaggle/kaggle.json
          chmod 600 ~/.kaggle/kaggle.json

      - name: Push and Run Kaggle Notebook
        run: |
          kaggle kernels push -p .